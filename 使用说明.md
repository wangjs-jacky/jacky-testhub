# 表格工具集使用说明

## 📋 概述

本项目提供了两种使用方式：

1. **全局工具脚本** (`table-utils.js`) - 可在浏览器控制台直接使用
2. **Chrome 插件** (基于 Plasmo 框架) - 提供可视化界面

## 🚀 方式一：全局工具脚本

### 使用方法

1. 打开包含表格的网页
2. 按 `F12` 打开开发者工具，切换到"控制台"标签
3. 复制 `table-utils.js` 文件的全部内容
4. 粘贴到控制台并回车执行
5. 所有函数将挂载到 `window.tableUtils` 对象

### 可用函数

```javascript
// 1. 检查表格行数
tableUtils.checkTableRows()
// 返回: { totalRows, contentRows, emptyRows, ... }

// 2. 获取当前行数
tableUtils.getCurrentRowCount()
// 返回: 数字

// 3. 添加表格行（直到达到目标行数）
await tableUtils.addTableRows(13)
// 参数: targetCount (目标行数)
// 返回: { success, currentCount, targetCount, added, ... }

// 4. 提取表格数据
const data = tableUtils.extractTableData()
// 返回: 数组，格式为 [{ 步骤序号, 步骤描述, 预期结果 }, ...]

// 5. 填充表格数据
tableUtils.fillTableData(data)
// 参数: data (数组格式的数据)
// 返回: { success, filled, total, errors }

// 6. 导出为 JSON
const json = tableUtils.exportToJSON(data)
// 返回: JSON 字符串
```

### 示例

```javascript
// 检查当前表格状态
const info = tableUtils.checkTableRows()
console.log(`总行数: ${info.totalRows}, 有内容: ${info.contentRows}`)

// 如果行数不足，添加行
if (info.totalRows < 13) {
  await tableUtils.addTableRows(13)
}

// 提取数据
const data = tableUtils.extractTableData()
console.log('提取的数据:', data)

// 导出为 JSON 并复制到剪贴板
const json = tableUtils.exportToJSON(data)
navigator.clipboard.writeText(json)
console.log('已复制到剪贴板')
```

## 🎨 方式二：Chrome 插件

### 安装步骤

1. **安装依赖**
   ```bash
   npm install
   ```

2. **开发模式**
   ```bash
   npm run dev
   ```
   这会生成开发版本的插件到 `build/chrome-mv3-dev` 目录

3. **加载插件**
   - 打开 Chrome 浏览器，访问 `chrome://extensions/`
   - 开启"开发者模式"（右上角开关）
   - 点击"加载已解压的扩展程序"
   - 选择 `build/chrome-mv3-dev` 目录

### 插件功能

插件面板提供四个主要功能按钮：

1. **🔍 检查行数**
   - 点击后显示表格的总行数、有内容的行数、空行数

2. **➕ 添加行**
   - 点击后弹出输入框，输入目标行数
   - 自动点击"添加步骤"按钮，直到达到目标行数

3. **📥 提取数据**
   - 从当前页面的表格中提取数据
   - 提取的数据会显示在下方的文本框中
   - 数据格式为 JSON，可以直接编辑

4. **📤 填充数据**
   - 将文本框中的数据填充回表格
   - 支持编辑后再填充

### 打开侧边栏

- **点击扩展图标**：点击浏览器工具栏中的扩展图标
- **快捷键**：使用 `Ctrl+U` (Windows/Linux) 或 `Command+U` (macOS)

> 💡 可以在 `chrome://extensions/shortcuts` 中自定义快捷键

### 工作流程示例

1. 打开包含测试用例表格的页面
2. 点击插件图标或使用快捷键 `Ctrl+U` (Windows/Linux) 或 `Command+U` (macOS)，打开侧边栏
3. 点击"🔍 检查行数"，查看当前表格状态
4. 如果行数不足，点击"➕ 添加行"，输入目标行数（如 13）
5. 点击"📥 提取数据"，提取表格数据
6. 在文本框中编辑数据（如果需要）
7. 点击"📤 填充数据"，将数据填充回表格

## 📝 数据格式

提取和填充的数据格式为 JSON 数组：

```json
[
  {
    "步骤序号": 1,
    "步骤描述": "等待\"10000ms\"",
    "预期结果": ""
  },
  {
    "步骤序号": 2,
    "步骤描述": "点击[SKU区域]下的[套餐卡片2]",
    "预期结果": "**APP** [底部bar]展示\"低至\",\"CNY 3.00\",\"每人\""
  }
]
```

## ⚠️ 注意事项

1. **表格结构要求**
   - 支持标准 HTML 表格 (`<table>`)
   - 支持 Ant Design 表格 (`.ant-table-tbody`)
   - 表格需要包含"步骤描述"和"预期结果"列

2. **动态内容**
   - 如果表格内容是动态加载的，请确保在内容加载完成后再执行操作

3. **React 应用**
   - 填充数据时会触发相应的事件，确保 React 状态更新
   - 如果遇到问题，可以尝试手动触发页面刷新

4. **权限要求**
   - Chrome 插件需要访问当前标签页的权限
   - 首次使用时可能需要授权

## 🔧 开发

### 构建生产版本

```bash
npm run build
```

### 打包插件

```bash
npm run package
```

会生成 `.zip` 文件，可以上传到 Chrome Web Store。

## 📚 相关文件

- `table-utils.js` - 全局工具脚本（可在控制台使用）
- `popup.tsx` - 插件弹窗 UI
- `contents/inject.ts` - Content Script（注入到页面）
- `package.json` - 项目配置
- `README-PLASMO.md` - Plasmo 插件详细文档

## 🐛 问题排查

1. **插件无法加载**
   - 检查是否开启了开发者模式
   - 查看 `chrome://extensions/` 中的错误信息

2. **提取数据为空**
   - 确认页面包含表格
   - 检查表格结构是否符合要求
   - 在控制台执行 `tableUtils.findTableRows()` 查看是否能找到表格

3. **填充数据失败**
   - 确认表格有足够的行数
   - 检查数据格式是否正确
   - 查看控制台错误信息

4. **添加行不工作**
   - 确认页面上有"添加步骤"按钮
   - 检查按钮是否被禁用
   - 尝试手动点击按钮确认功能正常

## 💡 提示

- 建议先使用"检查行数"功能确认表格状态
- 提取数据后可以先复制到外部编辑器进行编辑
- 填充前建议先备份原始数据
- 对于大量数据，建议分批处理
